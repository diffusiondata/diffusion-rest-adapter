Diffusion REST Adapter
# REST to Streaming Adapter

`TODO: Rename the project`

## Configuration Model

The configuration model is made of three top level sections, Diffusion, Services and Truststore.

### Diffusion

The Diffusion section describes the server to connect the client to.
It contains the `host`, `port`, `secure`, `principal` and `password`. `TODO: More detail`

### Services

The Services section contains a list of services.

#### Service

The Service describes a REST service to poll.
It contains the `host`, `port`, `secure`, `pollPeriod`, `topicRoot`, `endpoints` and `security`. `TODO: More detail`

#### Endpoint

The Endpoint describes an endpoint of a REST service to poll.
It contains the `name`, `url` and `topic`. `TODO: More detail`

#### Security

The Security describes how to authenticate with the service. Currently supported is `basic` which contains the
`principal` and `credential` used to respond to a basic authentication request. Basic authentication will not be
performed over an insecure connection.

### Truststore

The truststore is a string identifying the location of a keystore containing the trusted certificates of both the
Diffusion server and any REST services. An SSLContext is constructed from this. The string will first be resolved
against the classpath to try to load the keystore as a resource. If the keystore is not present as a resource it will
try to load the keystore from the filesystem relative to the current working directory.

## Filesystem configuration persistence

The configuration model consists of two files `service.json` and `service.version.json`. `TODO : Rename the config
files` The `service.version.json` file contains a single number that describes the version of the model. The
`service.json` file contains the configuration model serialised as JSON.

The files are parsed and generated by Jackson's JSON data binding features, all JSON processing is delegated to it.

## Topic management

An update source is registered for each service. When it becomes active a `JSON` topic will be created for each endpoint
of the service.

The client will request that the topics are removed with the session for each service.

## Polling

The client polls each endpoint at the rate configured for the service. When a response is received it is converted to a
`JSON` value and published to the Diffusion topic created for the endpoint.

## Reconfiguration

### Detecting reconfiguration

The client currently support polling a persisted model for changes. When a change is detected it will reconfigure to
use the new model.

### Applying reconfiguration

The client will perform a partial reconfiguration to update only what has changed. On reconfiguration new components are
first created and started. Once the new components are in place the old components are stopped and removed. The new
components may be in standby until the old components are stopped.

## Building

### Running integration tests

The integration tests require a Diffusion server to run against. They are run by the profile, `integration-test`,
enabled when the environmental property `DIFFUSION_HOME` is set. They use the `diffusion-maven-plugin` to start up and
shutdown the the Diffusion server. The `diffusion-maven-plugin` requires a system dependency to run, these `systemPath`
for this dependency is relative to the `DIFFUSION_HOME` environmental variable. Any REST service is started embedded
within the JVM process.
